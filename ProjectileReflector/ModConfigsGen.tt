<#@ include file="ModConfigsGen.ttinclude" #><#@ output extension=".cs" #>
using System;
using System.Collections.Generic;
using UnityEngine;
using YukkuriC;


namespace ProjectileReflector
{
    public static class ModConfigs
    {
<#
    foreach (var line in lines)
    {
#>
        public static <#= line["type"] #> <#= line["name"] #> { get => ModConfigEntry.INSTANCE.<#= line["name"] #>; }
<#
    }
#>
    }

    [Serializable]
    public partial class ModConfigEntry
    {
        private static ModConfigEntry instance = new ModConfigEntry();
<#
    foreach (var line in lines)
    {
#>
        public <#= line["type"] #> <#= line["name"] #> = <#= line["default"] #>;
<#
    }
#>
    }

    // mod config menu compat
    namespace Compat
    {
        public static partial class ModSettingMenu
        {
            public static void Reset()
            {
                if (!ModSettingAPI.IsInit) return;
                var config = ModConfigEntry.INSTANCE;
<#
    foreach (var line in lines)
    {
#>
                ModSettingAPI.SetValue("<#= line["name"] #>", config.<#= line["name"] #>);
<#
    }
#>
            }
            static void AddUI(bool isChinese)
            {
                var config = ModConfigEntry.INSTANCE;
<#
    foreach (var line in lines)
    {
        if (line["type"] == "bool")
        {
#>
                ModSettingAPI.AddToggle(
                    "<#= line["name"] #>",
                    isChinese ? "<#= line["descrip_cn"] #>" : "<#= Escape(line["descrip_en"]) #>",
                    config.<#= line["name"] #>,
                    WrapOnChange<<#= line["type"] #>>(v => config.<#= line["name"] #> = v)
                );
<#
        }
        else
        {
#>
                ModSettingAPI.AddSlider(
                    "<#= line["name"] #>",
                    isChinese ? "<#= line["descrip_cn"] #>" : "<#= Escape(line["descrip_en"]) #>",
                    config.<#= line["name"] #>,
                    new Vector2(<#= line["min"] #>, <#= line["max"] #>),
                    WrapOnChange<<#= line["type"] #>>(v => config.<#= line["name"] #> = v)
                );
<#
        }
    }
#>
<#
    foreach (var kv in linesByGroup)
    {
        var group = kv.Key;
        var allNames = (from l in kv.Value select $"\"{l["name"]}\"");
#>
                ModSettingAPI.AddGroup("<#= group #>", "<#= group #>", new List<string>() { <#= string.Join(", ", allNames) #> });
<#
    }
#>
            }
        }
        public static partial class ModConfigMenu
        {
            static void SetupModConfig(bool isChinese)
            {
                var config = ModConfigEntry.INSTANCE;
<#
    foreach (var line in Enumerable.Reverse(lines))
    {
#>
<#
        if (line["type"] == "bool")
        {
#>
                ModConfigAPI.SafeAddBoolDropdownList(
                    MOD_NAME,
                    "<#= line["name"] #>",
                    isChinese ? "<#= line["descrip_cn"] #>" : "<#= Escape(line["descrip_en"]) #>",
                    config.<#= line["name"] #>
                );
<#
        }
        else
        {
#>
                ModConfigAPI.SafeAddInputWithSlider(
                    MOD_NAME,
                    "<#= line["name"] #>",
                    isChinese ? "<#= line["descrip_cn"] #>" : "<#= Escape(line["descrip_en"]) #>",
                    typeof(<#= line["type"] #>),
                    config.<#= line["name"] #>,
                    new Vector2(<#= line["min"] #>, <#= line["max"] #>)
                );
<#
        }
    }
#>
            }
            static void LoadConfigFromModConfig()
            {
                var config = ModConfigEntry.INSTANCE;
<#
    foreach (var line in lines)
    {
#>
                config.<#= line["name"] #> = ModConfigAPI.SafeLoad(MOD_NAME, "<#= line["name"] #>", config.<#= line["name"] #>);
<#
    }
#>
            }
        }
    }
}
